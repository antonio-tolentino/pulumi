name: books
description: A minimal Kubernetes Pulumi YAML program
runtime: yaml

configuration:
  name:
    type: String
  env:
    default: dev

variables:
  appLabels:
    app: books

resources:
  deployment:
    type: kubernetes:apps/v1:Deployment
    properties:
      metadata:
        name: books
        labels: ${appLabels}    
      spec:
        selector:
          matchLabels: ${appLabels}
        replicas: 1
        template:
          metadata:
            labels: ${appLabels}
          spec:
            containers:
              - name: books
                image: tolentino/books:v1.1.0
                ports:
                  - name: http
                    containerPort: 9090
                    protocol: TCP
  service:
    type: kubernetes:core/v1:Service
    properties:
      metadata:
        name: books
        labels: ${appLabels}
      spec:
        type: ClusterIP
        selector: ${appLabels}
        ports:
          - port: 80
            targetPort: 8080
            protocol: TCP
            
outputs:
    name: ${deployment.metadata.name}
    ip: ${service.spec.clusterIP}
